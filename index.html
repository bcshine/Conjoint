<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì½˜ì¡°ì¸íŠ¸ ë¶„ì„ í”„ë¡œê·¸ë¨</title>
    <!-- Chart.js ì¶”ê°€ -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.7.1/dist/chart.min.js"></script>
    <style>
        :root {
            --primary-color: #4c6ef5;
            --secondary-color: #f8f9fa;
            --border-color: #dee2e6;
            --text-color: #212529;
            --success-color: #38b2ac;
            
            /* Modern, elegant color palette */
            --chart-color-1: #5B7FFF; /* Soft blue */
            --chart-color-2: #36D1DC; /* Turquoise */
            --chart-color-3: #5C54A4; /* Medium purple */
            --chart-color-4: #FF7676; /* Coral pink */
            --chart-color-5: #4CB58E; /* Mint green */
        }
        
        body {
            font-family: 'Noto Sans KR', sans-serif;
            line-height: 1.6;
            color: var(--text-color);
            background-color: #f8f9fa;
            margin: 0;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background-color: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }
        
        h1, h2, h3 {
            color: var(--primary-color);
            margin-top: 0;
        }
        
        input, select, button {
            font-family: inherit;
            font-size: 16px;
            padding: 8px 12px;
            border-radius: 4px;
            border: 1px solid var(--border-color);
        }
        
        button {
            background-color: var(--primary-color);
            color: white;
            cursor: pointer;
            border: none;
            padding: 10px 15px;
            margin: 10px 0;
            transition: background-color 0.3s;
        }
        
        button:hover {
            background-color: #364fc7;
        }
        
        .step {
            margin-bottom: 30px;
            padding: 20px;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            background-color: white;
        }
        
        .step h2 {
            margin-top: 0;
            border-bottom: 2px solid var(--primary-color);
            padding-bottom: 10px;
            margin-bottom: 20px;
        }
        
        .attribute-container, .product-container {
            margin-bottom: 20px;
            padding: 15px;
            background-color: var(--secondary-color);
            border-radius: 8px;
        }
        
        .level-container {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .level-container input {
            margin-right: 10px;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }
        
        th, td {
            border: 1px solid var(--border-color);
            padding: 12px;
            text-align: left;
        }
        
        th {
            background-color: var(--primary-color);
            color: white;
        }
        
        tr:nth-child(even) {
            background-color: var(--secondary-color);
        }
        
        .results {
            display: none;
            margin-top: 30px;
        }
        
        .error {
            color: #e53e3e;
            margin: 5px 0;
        }
        
        .success {
            color: var(--success-color);
            margin: 5px 0;
        }
        
        .hide {
            display: none;
        }
        
        .btn-secondary {
            background-color: #6c757d;
        }
        
        .btn-secondary:hover {
            background-color: #5a6268;
        }
        
        .btn-reset {
            background-color: #e53e3e;
        }
        
        .btn-reset:hover {
            background-color: #c53030;
        }
        
        .highlight {
            background-color: rgba(76, 110, 245, 0.1);
            padding: 2px;
        }
        
        /* ë§‰ëŒ€ ê·¸ë˜í”„ ë° ì°¨íŠ¸ ìŠ¤íƒ€ì¼ */
        .chart-container {
            margin: 20px 0;
            padding: 15px;
            background-color: var(--secondary-color);
            border-radius: 8px;
        }
        
        .pie-chart-container {
            width: 100%;
            max-width: 500px;
            margin: 20px auto;
            height: 300px;
            position: relative;
        }
        
        .charts-row {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            justify-content: space-between;
        }
        
        .chart-column {
            flex: 1;
            min-width: 300px;
        }
        
        .simulation-container {
            margin: 20px 0;
            padding: 20px;
            background-color: #ffffff;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
        }
        
        .simulation-controls {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .slider-container {
            flex: 1;
            min-width: 250px;
        }
        
        .slider-label {
            display: flex;
            justify-content: space-between;
            margin-bottom: 5px;
        }
        
        .simulation-slider {
            width: 100%;
        }
        
        .chart-title {
            font-weight: bold;
            margin-bottom: 10px;
        }
        
        .bar-chart {
            display: flex;
            flex-direction: column;
            gap: 15px;
            position: relative;
        }
        
        .bar-group {
            display: flex;
            align-items: center;
            margin-bottom: 8px;
        }
        
        .bar-label {
            width: 120px;
            font-weight: bold;
            margin-right: 10px;
            text-align: right;
        }
        
        .bar-wrapper {
            flex-grow: 1;
            position: relative;
            height: 30px;
            background-color: #fff;
            border-radius: 0;
        }
        
        .bar {
            height: 100%;
            border-radius: 0;
            transition: width 0.8s ease;
            position: relative;
        }
        
        .bar-value {
            position: absolute;
            right: 5px;
            top: 50%;
            transform: translateY(-50%);
            font-weight: bold;
            color: #fff;
            padding: 0 8px;
        }
        
        .bar-positive {
            background-color: var(--chart-color-2);
        }
        
        .bar-negative {
            background-color: var(--chart-color-4);
        }
        
        .bar-chart-grid {
            position: absolute;
            width: 100%;
            height: 100%;
            top: 0;
            left: 0;
            z-index: 0;
        }
        
        .grid-line {
            position: absolute;
            width: 1px;
            height: 100%;
            background-color: #ddd;
            z-index: 0;
        }
        
        .bar-chart-x-axis {
            position: relative;
            height: 20px;
            margin-top: 5px;
            margin-left: 130px;
            display: flex;
            justify-content: space-between;
            font-size: 12px;
            color: #666;
        }
        
        .product-chart {
            margin-bottom: 30px;
        }
        
        @media (max-width: 768px) {
            .container {
                padding: 15px;
            }
            
            .step {
                padding: 15px;
            }
            
            .bar-label {
                width: 80px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ì½˜ì¡°ì¸íŠ¸ ë¶„ì„ í”„ë¡œê·¸ë¨</h1>
        <p>ì œí’ˆì˜ ì†ì„±ê³¼ ìˆ˜ì¤€ì„ ì •ì˜í•˜ê³  ë‹¤í•­ ë¡œì§€íŠ¸ ëª¨ë¸ì„ ì‚¬ìš©í•˜ì—¬ ì‹œì¥ ì ìœ ìœ¨ì„ ì˜ˆì¸¡í•©ë‹ˆë‹¤.</p>
        
        <div class="step" id="step1">
            <h2>1ë‹¨ê³„: ì œí’ˆ ì¹´í…Œê³ ë¦¬ ë° ê²½ìŸì œí’ˆ ì •ì˜</h2>
            <div class="form-group">
                <label for="productCategory">ì œí’ˆ ì¹´í…Œê³ ë¦¬:</label>
                <input type="text" id="productCategory" placeholder="ì˜ˆ: ìŠ¤ë§ˆíŠ¸í°, ìŒë£Œìˆ˜, ì„¸íƒê¸° ë“±">
            </div>
            <div class="form-group">
                <label for="numProducts">ê²½ìŸì ìˆ˜ ê²°ì • (ë³¸ì¸ ì‹ ì œí’ˆ í¬í•¨):</label>
                <input type="number" id="numProducts" min="2" max="10" value="3">
                <button onclick="setupProducts()">ê²½ìŸì œí’ˆ ìˆ˜ ì„¤ì •</button>
            </div>
            
            <div id="productSetup" class="hide">
                <div class="form-group">
                    <label for="myProductName">ë³¸ì¸ ì‹ ì œí’ˆ ì´ë¦„:</label>
                    <input type="text" id="myProductName" placeholder="ë³¸ì¸ ì œí’ˆì˜ ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”">
                </div>
                <div id="competitorNames"></div>
                <div class="form-group">
                    <label for="numAttributes">ì´ ì‹œì¥ì—ì„œ ì¤‘ìš”í•œ ì†ì„±ì€ ëª‡ê°€ì§€ì¸ê°€ìš”? (4~8ê°œ):</label>
                    <input type="number" id="numAttributes" min="4" max="8" value="4">
                    <button onclick="setupAttributes()">ì†ì„± ì„¤ì •</button>
                </div>
            </div>
            
            <div id="attributeSetup" class="hide"></div>
            
            <div id="productDetails" class="hide"></div>
            
            <div class="form-group hide" id="populationGroup">
                <h3>3ë‹¨ê³„: ê²½ìŸì œí’ˆë³„ ì„¸ë¶€ ì‚¬í•­ ì…ë ¥ ì™„ë£Œ</h3>
                <label for="population">ì ì¬ê³ ê° ìˆ˜ (ëª…):</label>
                <input type="number" id="population" min="1" value="5000">
                <button onclick="calculateUtilities()" id="calculateBtn">AIë¡œ ìœ í‹¸ë¦¬í‹° ì¶”ì • ë° ê³„ì‚°í•˜ê¸°</button>
            </div>
        </div>
        
        <div class="results" id="resultsSection">
            <h2>4ë‹¨ê³„: ë¶„ì„ ê²°ê³¼</h2>
            
            <h3>ğŸ”¸ ê²°ê³¼1: ê²½ìŸì œí’ˆ X ì†ì„±ë³„ ìœ í‹¸ë¦¬í‹°</h3>
            <div id="utilityResults"></div>
            
            <h3>ğŸ”¸ ê²°ê³¼2: ê²½ìŸì œí’ˆë³„ ì‹œì¥ì ìœ ìœ¨(ì¶”ì •)</h3>
            <div class="charts-row">
                <div class="chart-column" style="flex: 1;">
                    <div class="chart-title">ì‹œì¥ ì ìœ ìœ¨(ì› ê·¸ë˜í”„)</div>
                    <div class="pie-chart-container" style="height: 400px; margin-bottom: 40px;">
                        <canvas id="marketSharePieChart"></canvas>
                    </div>
                </div>
            </div>
            
            <div id="marketShareResults" style="display: none;"></div>
            
            <h3 style="margin-top: 80px;">ğŸ”¸ ê²°ê³¼3: ì œí’ˆë³„ ìœ í‹¸ë¦¬í‹°í•©, ì„ íƒí™•ë¥ , ì˜ˆìƒì¸êµ¬</h3>
            <div id="summaryResults"></div>
            
            <h3 style="margin-top: 80px;">ğŸ” ê²°ê³¼4: ì‹œë®¬ë ˆì´ì…˜</h3>
            <div class="simulation-container">
                <h4>ë‚´ ì œí’ˆ ì†ì„± ë³€ê²½ ì‹œë®¬ë ˆì´ì…˜</h4>
                <p>ë‚´ ì œí’ˆì˜ ì†ì„±ì„ ì¡°ì •í•˜ì—¬ ì‹œì¥ ì ìœ ìœ¨ ë³€í™”ë¥¼ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
                <div id="simulationControls" class="simulation-controls-vertical"></div>
                <button onclick="runSimulation()" class="btn-secondary">ì‹œë®¬ë ˆì´ì…˜ ì‹¤í–‰</button>
                
                <div style="margin-top: 30px;">
                    <div style="margin-bottom: 100px;">
                        <div class="chart-title">ì‹œë®¬ë ˆì´ì…˜ ê²°ê³¼(ì› ê·¸ë˜í”„)</div>
                        <div class="pie-chart-container" style="height: 400px; margin: 0 auto 40px auto; max-width: 600px;">
                            <canvas id="simulationPieChart"></canvas>
                        </div>
                    </div>
                    
                    <div style="margin-bottom: 80px; margin-top: 300px;">
                        <div class="chart-title">ì‹œë®¬ë ˆì´ì…˜ ê²°ê³¼ - ì‹œì¥ ì ìœ ìœ¨ ë³€í™”</div>
                        <div id="simulationResults" style="margin-top: 20px;"></div>
                    </div>
                </div>
            </div>
            
            <div>
                <button onclick="resetSimulation()" class="btn-reset">ìƒˆë¡œìš´ ì‹œë®¬ë ˆì´ì…˜</button>
                <button onclick="adjustProduct()" class="btn-secondary">ì œí’ˆ ì†ì„± ì¡°ì •</button>
            </div>
        </div>
    </div>

    <script>
        // ì „ì—­ ë³€ìˆ˜
        let products = [];
        let attributes = [];
        let utilities = {};
        let marketSharePieChart = null;
        let simulationPieChart = null;
        let productCategory = '';
        
        // ì œí’ˆ ì„¤ì •
        function setupProducts() {
            const numProducts = parseInt(document.getElementById('numProducts').value);
            if (numProducts < 2 || numProducts > 10) {
                alert('ì œí’ˆ ìˆ˜ëŠ” 2ì—ì„œ 10 ì‚¬ì´ì—¬ì•¼ í•©ë‹ˆë‹¤.');
                return;
            }
            
            productCategory = document.getElementById('productCategory').value;
            if (!productCategory) {
                alert('ì œí’ˆ ì¹´í…Œê³ ë¦¬ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }
            
            products = [];
            for (let i = 0; i < numProducts; i++) {
                products.push({
                    id: i,
                    name: i === 0 ? 'ì‹ ì œí’ˆ' : `ê¸°ì¡´ ì œí’ˆ ${String.fromCharCode(65 + i - 1)}`,
                    attributes: {}
                });
            }
            
            document.getElementById('productSetup').classList.remove('hide');
            
            // ê²½ìŸì ì´ë¦„ ì…ë ¥ í•„ë“œ ìƒì„±
            const competitorNamesDiv = document.getElementById('competitorNames');
            competitorNamesDiv.innerHTML = '';
            
            // ì²«ë²ˆì§¸ ì œí’ˆ(ì‹ ì œí’ˆ)ì€ ë³„ë„ ì…ë ¥ í•„ë“œê°€ ìˆìœ¼ë¯€ë¡œ 1ë¶€í„° ì‹œì‘
            for (let i = 1; i < numProducts; i++) {
                const competitorGroup = document.createElement('div');
                competitorGroup.className = 'form-group';
                
                const competitorLabel = document.createElement('label');
                competitorLabel.textContent = `ê²½ìŸ ì œí’ˆ ${i} ì´ë¦„:`;
                
                const competitorInput = document.createElement('input');
                competitorInput.type = 'text';
                competitorInput.id = `competitorName_${i}`;
                competitorInput.placeholder = `ê²½ìŸ ì œí’ˆ ${i}ì˜ ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”`;
                
                competitorGroup.appendChild(competitorLabel);
                competitorGroup.appendChild(competitorInput);
                competitorNamesDiv.appendChild(competitorGroup);
            }
        }
        
        // ì†ì„± ì„¤ì •
        function setupAttributes() {
            const numAttributes = parseInt(document.getElementById('numAttributes').value);
            if (numAttributes < 4 || numAttributes > 8) {
                alert('ì†ì„± ìˆ˜ëŠ” 4ì—ì„œ 8 ì‚¬ì´ì—¬ì•¼ í•©ë‹ˆë‹¤.');
                return;
            }
            
            // ì œí’ˆ ì´ë¦„ ì—…ë°ì´íŠ¸
            const myProductName = document.getElementById('myProductName').value;
            if (!myProductName) {
                alert('ë³¸ì¸ ì‹ ì œí’ˆ ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }
            
            // ì²«ë²ˆì§¸ ì œí’ˆì€ ë³¸ì¸ ì œí’ˆ
            products[0].name = myProductName;
            
            // ê²½ìŸ ì œí’ˆ ì´ë¦„ ì—…ë°ì´íŠ¸
            for (let i = 1; i < products.length; i++) {
                const competitorName = document.getElementById(`competitorName_${i}`).value;
                if (competitorName) {
                    products[i].name = competitorName;
                }
            }
            
            attributes = [];
            const attributeSetup = document.getElementById('attributeSetup');
            attributeSetup.innerHTML = '';
            attributeSetup.classList.remove('hide');
            
            const attributeTitle = document.createElement('h3');
            attributeTitle.textContent = '2ë‹¨ê³„: ì†ì„±ì˜ ìˆ˜ ê²°ì • (4~8ê°œ) ë° ìˆ˜ì¤€ ì •ì˜ (2~4ê°œ)';
            attributeSetup.appendChild(attributeTitle);
            
            // ì•ˆë‚´ ë©”ì‹œì§€ ì¶”ê°€
            const attributeGuide = document.createElement('div');
            attributeGuide.className = 'guide-message';
            attributeGuide.style.backgroundColor = '#f8f9fa';
            attributeGuide.style.padding = '10px';
            attributeGuide.style.borderRadius = '5px';
            attributeGuide.style.marginBottom = '15px';
            attributeGuide.style.borderLeft = '4px solid var(--primary-color)';
            attributeGuide.innerHTML = '<strong>ì•ˆë‚´:</strong> ê° ì†ì„±ì€ ì—°êµ¬í•˜ê³ ì í•˜ëŠ” ì œí’ˆì˜ íŠ¹ì„±ì— ë§ê²Œ ì§ì ‘ ê¸°ì…í•˜ì„¸ìš”. ê¸°ë³¸ìœ¼ë¡œ ì œê³µëœ ì†ì„±ëª…ì€ ì˜ˆì‹œì¼ ë¿ì…ë‹ˆë‹¤.';
            attributeSetup.appendChild(attributeGuide);
            
            const attributeNames = ['í’ˆì§ˆ (ì˜ˆì‹œ)', 'ë””ìì¸ (ì˜ˆì‹œ)', 'ê°€ê²© (ì˜ˆì‹œ)', 'ê¸°ëŠ¥ (ì˜ˆì‹œ)', 'ìš©ëŸ‰ (ì˜ˆì‹œ)'];
            const scaleTypes = ['ë¹„ìœ¨ì²™ë„', 'ëª…ëª©ì²™ë„'];
            
            for (let i = 0; i < numAttributes; i++) {
                const attributeContainer = document.createElement('div');
                attributeContainer.className = 'attribute-container';
                
                const nameLabel = document.createElement('label');
                nameLabel.textContent = `ì†ì„± ${i + 1} ì´ë¦„:`;
                
                const nameInput = document.createElement('input');
                nameInput.type = 'text';
                nameInput.id = `attributeName${i}`;
                nameInput.value = i < attributeNames.length ? attributeNames[i] : '';
                
                const scaleLabel = document.createElement('label');
                scaleLabel.textContent = 'ì²™ë„ ìœ í˜•:';
                
                const scaleSelect = document.createElement('select');
                scaleSelect.id = `attributeScale${i}`;
                
                scaleTypes.forEach(scale => {
                    const option = document.createElement('option');
                    option.value = scale;
                    option.textContent = scale;
                    scaleSelect.appendChild(option);
                });
                
                const levelCountLabel = document.createElement('label');
                levelCountLabel.textContent = 'ìˆ˜ì¤€ ê°œìˆ˜ (2~4ê°œ):';
                
                const levelCountInput = document.createElement('input');
                levelCountInput.type = 'number';
                levelCountInput.id = `levelCount${i}`;
                levelCountInput.min = '2';
                levelCountInput.max = '4';
                levelCountInput.value = '3';
                
                const levelContainer = document.createElement('div');
                levelContainer.id = `levelContainer${i}`;
                
                const setupLevelsBtn = document.createElement('button');
                setupLevelsBtn.textContent = 'ìˆ˜ì¤€ ì„¤ì •';
                setupLevelsBtn.onclick = function() {
                    setupLevels(i);
                };
                
                attributeContainer.appendChild(nameLabel);
                attributeContainer.appendChild(nameInput);
                attributeContainer.appendChild(document.createElement('br'));
                attributeContainer.appendChild(scaleLabel);
                attributeContainer.appendChild(scaleSelect);
                attributeContainer.appendChild(document.createElement('br'));
                attributeContainer.appendChild(levelCountLabel);
                attributeContainer.appendChild(levelCountInput);
                attributeContainer.appendChild(setupLevelsBtn);
                attributeContainer.appendChild(levelContainer);
                
                attributeSetup.appendChild(attributeContainer);
            }
            
            // ëª¨ë“  ì†ì„±ì˜ ìˆ˜ì¤€ í™•ì¸ ë©”ì‹œì§€
            const infoMsg = document.createElement('div');
            infoMsg.style.backgroundColor = 'lightyellow';
            infoMsg.style.padding = '10px';
            infoMsg.style.marginTop = '20px';
            infoMsg.style.borderRadius = '5px';
            infoMsg.innerHTML = `
                <p><strong>ì†ì„± ë³„ ìˆ˜ì¤€ ì„¤ì • ì•ˆë‚´:</strong></p>
                <ol>
                    <li>ê° ì†ì„±ë³„ë¡œ "ìˆ˜ì¤€ ì„¤ì •" ë²„íŠ¼ì„ í´ë¦­í•˜ì—¬ ìˆ˜ì¤€ì„ ì •ì˜í•´ì£¼ì„¸ìš”.</li>
                    <li>ìˆ˜ì¤€ì€ ë‚®ì€ ìˆ˜ì¤€ë¶€í„° ë†’ì€ ìˆ˜ì¤€ ìˆœìœ¼ë¡œ ì…ë ¥í•˜ëŠ” ê²ƒì´ ì¢‹ìŠµë‹ˆë‹¤.</li>
                    <li>ì˜ˆ: ê°€ê²©ì€ ë‚®ì€ ê°€ê²©ë¶€í„° ë†’ì€ ê°€ê²© ìˆœìœ¼ë¡œ, í’ˆì§ˆì€ ë‚®ì€ í’ˆì§ˆë¶€í„° ë†’ì€ í’ˆì§ˆ ìˆœìœ¼ë¡œ.</li>
                    <li>ëª¨ë“  ì†ì„±ì˜ ìˆ˜ì¤€ì„ ì„¤ì •í•œ í›„ ì•„ë˜ ë²„íŠ¼ì„ í´ë¦­í•˜ì„¸ìš”.</li>
                    <li>ë¹„ìœ¨ì²™ë„ëŠ” '100ì ë§Œì ì— (__) ì ' í˜•ì‹ìœ¼ë¡œ ê¸°ì…í•´ì£¼ì„¸ìš”. (ì˜ˆ: '100ì ë§Œì ì— 75ì ')</li>
                    <li>ëª…ëª©ì²™ë„ëŠ” í•­ëª©ì˜ ì´ë¦„ì„ ì§ì ‘ ê¸°ì…í•´ì£¼ì„¸ìš”. (ì˜ˆ: 'ê¸°ë³¸í˜•', 'í”„ë¦¬ë¯¸ì—„í˜•')</li>
                    <li>ê°€ê²© ì†ì„±ì€ ì§ì ‘ ê°€ê²©ì„ ê¸°ì…í•´ì£¼ì„¸ìš”. (ì˜ˆ: '3000ì›', '5000ì›')</li>
                </ol>
            `;
            attributeSetup.appendChild(infoMsg);
            
            const setupProductsBtn = document.createElement('button');
            setupProductsBtn.textContent = 'ì†ì„± í™•ì • í›„ ì œí’ˆ ì„¸ë¶€ì‚¬í•­ ì…ë ¥';
            setupProductsBtn.style.marginTop = '15px';
            setupProductsBtn.onclick = function() {
                finalizeAttributes();
            };
            
            attributeSetup.appendChild(setupProductsBtn);
        }
        
        // ìˆ˜ì¤€ ì„¤ì •
        function setupLevels(attributeIndex) {
            const levelCount = parseInt(document.getElementById(`levelCount${attributeIndex}`).value);
            if (levelCount < 2 || levelCount > 4) {
                alert('ìˆ˜ì¤€ ê°œìˆ˜ëŠ” 2ì—ì„œ 4 ì‚¬ì´ì—¬ì•¼ í•©ë‹ˆë‹¤.');
                return;
            }
            
            const levelContainer = document.getElementById(`levelContainer${attributeIndex}`);
            levelContainer.innerHTML = '';
            
            const attributeName = document.getElementById(`attributeName${attributeIndex}`).value;
            const scale = document.getElementById(`attributeScale${attributeIndex}`).value;
            
            // ì†ì„±ë³„ ìì„¸í•œ ìˆ˜ì¤€ ì„¤ëª…ê³¼ ì˜ˆì‹œ ì œê³µ
            const attributeExamples = {
                'ê°€ê²©': {
                    levels: ['3000ì›', '5000ì›', '7000ì›', '9000ì›', '12000ì›'],
                    description: 'ì œí’ˆ ê°€ê²©ì„ ì˜ë¯¸í•©ë‹ˆë‹¤. ì¼ë°˜ì ìœ¼ë¡œ ê°€ê²©ì´ ë‚®ì„ìˆ˜ë¡ ì†Œë¹„ì ì„ í˜¸ë„ê°€ ë†’ì•„ì§‘ë‹ˆë‹¤.'
                },
                'í’ˆì§ˆ': {
                    levels: ['í•˜', 'ì¤‘', 'ìƒ', 'ìµœìƒ', 'í”„ë¦¬ë¯¸ì—„'],
                    description: 'ì œí’ˆì˜ í’ˆì§ˆ ìˆ˜ì¤€ì„ ì˜ë¯¸í•©ë‹ˆë‹¤. ì¼ë°˜ì ìœ¼ë¡œ í’ˆì§ˆì´ ë†’ì„ìˆ˜ë¡ ì†Œë¹„ì ì„ í˜¸ë„ê°€ ë†’ì•„ì§‘ë‹ˆë‹¤.'
                },
                'ë””ìì¸': {
                    levels: ['ì‹¬í”Œ', 'ëª¨ë˜', 'í´ë˜ì‹', 'ìœ ë‹ˆí¬', 'í˜ì‹ ì '],
                    description: 'ì œí’ˆì˜ ë””ìì¸ ìŠ¤íƒ€ì¼ì„ ì˜ë¯¸í•©ë‹ˆë‹¤. ëª©í‘œ ì‹œì¥ì— ë”°ë¼ ì„ í˜¸ë˜ëŠ” ë””ìì¸ì´ ë‹¤ë¥¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.'
                },
                'ë¸Œëœë“œ': {
                    levels: ['ì‹ ì œí’ˆ', 'ì¸ê¸°ë¸Œëœë“œ', 'ê¸€ë¡œë²Œë¸Œëœë“œ', 'í”„ë¦¬ë¯¸ì—„ë¸Œëœë“œ', 'ëŸ­ì…”ë¦¬ë¸Œëœë“œ'],
                    description: 'ì œí’ˆì˜, ë¸Œëœë“œ ì¸ì§€ë„ ë˜ëŠ” ë¸Œëœë“œ ê°€ì¹˜ë¥¼ ì˜ë¯¸í•©ë‹ˆë‹¤.'
                },
                'ê¸°ëŠ¥': {
                    levels: ['ê¸°ë³¸í˜•', 'ì¤‘ê¸‰í˜•', 'ê³ ê¸‰í˜•', 'í”„ë¦¬ë¯¸ì—„í˜•', 'ìµœê³ ê¸‰í˜•'],
                    description: 'ì œí’ˆì´ ì œê³µí•˜ëŠ” ê¸°ëŠ¥ì˜ ìˆ˜ì¤€ì„ ì˜ë¯¸í•©ë‹ˆë‹¤.'
                }
            };
            
            // ê¸°ë³¸ ì˜ˆì‹œ ê°’
            const defaultExamples = ['ìˆ˜ì¤€ 1', 'ìˆ˜ì¤€ 2', 'ìˆ˜ì¤€ 3', 'ìˆ˜ì¤€ 4', 'ìˆ˜ì¤€ 5'];
            
            // ì†ì„±ì— ëŒ€í•œ ì„¤ëª… ì¶”ê°€
            const attributeDescription = document.createElement('p');
            attributeDescription.className = 'attribute-description';
            attributeDescription.style.marginBottom = '15px';
            attributeDescription.style.fontStyle = 'italic';
            
            if (attributeExamples[attributeName]) {
                attributeDescription.textContent = attributeExamples[attributeName].description;
            } else {
                attributeDescription.textContent = `${attributeName}ì˜ ì„œë¡œ ë‹¤ë¥¸ ìˆ˜ì¤€ì„ ì •ì˜í•´ì£¼ì„¸ìš”.`;
            }
            
            levelContainer.appendChild(attributeDescription);
            
            // ìˆ˜ì¤€ ì •ì˜ í—¤ë”
            const levelHeader = document.createElement('h4');
            levelHeader.textContent = `${attributeName}ì˜ ìˆ˜ì¤€ ì •ì˜ (ë‚®ì€ ìˆ˜ì¤€ â†’ ë†’ì€ ìˆ˜ì¤€ ìˆœìœ¼ë¡œ ì…ë ¥):`;
            levelContainer.appendChild(levelHeader);
            
            // ìˆ˜ì¤€ ì •ì˜ ì…ë ¥ í•„ë“œ
            for (let i = 0; i < levelCount; i++) {
                const levelDiv = document.createElement('div');
                levelDiv.className = 'level-container';
                
                const levelLabel = document.createElement('label');
                levelLabel.textContent = `ìˆ˜ì¤€ ${i + 1}:`;
                
                const levelInput = document.createElement('input');
                levelInput.type = 'text';
                levelInput.id = `level_${attributeIndex}_${i}`;
                levelInput.style.width = '250px';
                
                // ì²™ë„ ìœ í˜•ì— ë”°ë¼ ë‹¤ë¥¸ ì˜ˆì‹œ ë° placeholder ì œê³µ
                if (attributeName.includes('ê°€ê²©')) {
                    // ê°€ê²© ì†ì„±ì€ ì§ì ‘ ê°€ê²© ì…ë ¥
                    levelInput.placeholder = 'ì§ì ‘ ê°€ê²©ì„ ì…ë ¥í•˜ì„¸ìš” (ì˜ˆ: 3000ì›)';
                    if (attributeExamples[attributeName] && i < attributeExamples[attributeName].levels.length) {
                        levelInput.value = attributeExamples[attributeName].levels[i];
                    } else {
                        levelInput.value = `${(i+1) * 1000}ì›`;
                    }
                } else if (scale === 'ë¹„ìœ¨ì²™ë„') {
                    // ë¹„ìœ¨ì²™ë„ëŠ” 100ì  ë§Œì  í˜•ì‹
                    levelInput.placeholder = '100ì ë§Œì ì— (__) ì ';
                    const points = (i + 1) * 20; // 20, 40, 60, 80, 100 ë“±ìœ¼ë¡œ ë¶„í¬
                    levelInput.value = `100ì ë§Œì ì— ${points}ì `;
                } else { // ëª…ëª©ì²™ë„
                    // ëª…ëª©ì²™ë„ëŠ” ì§ì ‘ ì…ë ¥
                    levelInput.placeholder = 'ì§ì ‘ ì…ë ¥ (ì˜ˆ: ê¸°ë³¸í˜•, í”„ë¦¬ë¯¸ì—„ ë“±)';
                    if (attributeExamples[attributeName] && i < attributeExamples[attributeName].levels.length) {
                        levelInput.value = attributeExamples[attributeName].levels[i];
                    } else {
                        levelInput.value = defaultExamples[i];
                    }
                }
                
                // ì˜ˆì‹œ í‘œì‹œ
                const levelExample = document.createElement('span');
                levelExample.style.marginLeft = '10px';
                levelExample.style.color = '#666';
                levelExample.style.fontSize = '0.9em';
                
                if (i === 0) levelExample.textContent = '(ê°€ì¥ ë‚®ì€ ìˆ˜ì¤€)';
                if (i === levelCount - 1) levelExample.textContent = '(ê°€ì¥ ë†’ì€ ìˆ˜ì¤€)';
                
                // ìœ í‹¸ë¦¬í‹° ê°’ì€ hidden inputìœ¼ë¡œ ë³€ê²½ (AIê°€ ìë™ ê³„ì‚°í•¨)
                const utilityInput = document.createElement('input');
                utilityInput.type = 'hidden';
                utilityInput.id = `utility_${attributeIndex}_${i}`;
                utilityInput.value = '0'; // ì´ˆê¸°ê°’, ë‚˜ì¤‘ì— AIê°€ ê³„ì‚°
                
                levelDiv.appendChild(levelLabel);
                levelDiv.appendChild(levelInput);
                levelDiv.appendChild(levelExample);
                levelDiv.appendChild(utilityInput);
                
                levelContainer.appendChild(levelDiv);
            }
        }
        
        // ì†ì„± í™•ì •
        function finalizeAttributes() {
            attributes = [];
            
            for (let i = 0; i < parseInt(document.getElementById('numAttributes').value); i++) {
                const name = document.getElementById(`attributeName${i}`).value;
                const scale = document.getElementById(`attributeScale${i}`).value;
                const levelCount = parseInt(document.getElementById(`levelCount${i}`).value);
                
                const levels = [];
                
                for (let j = 0; j < levelCount; j++) {
                    const levelElement = document.getElementById(`level_${i}_${j}`);
                    
                    if (!levelElement) {
                        alert(`${name} ì†ì„±ì˜ ìˆ˜ì¤€ì„ ë¨¼ì € ì„¤ì •í•´ì£¼ì„¸ìš”.`);
                        return;
                    }
                    
                    const level = levelElement.value;
                    levels.push(level);
                }
                
                attributes.push({
                    id: i,
                    name: name,
                    scale: scale,
                    levels: levels
                });
            }
            
            setupProductDetails();
        }
        
        // ì œí’ˆ ì„¸ë¶€ì‚¬í•­ ì„¤ì •
        function setupProductDetails() {
            const productDetails = document.getElementById('productDetails');
            productDetails.innerHTML = '';
            productDetails.classList.remove('hide');
            
            const detailTitle = document.createElement('h3');
            detailTitle.textContent = '3ë‹¨ê³„: ê²½ìŸì œí’ˆë³„ ì„¸ë¶€ ì‚¬í•­ ì…ë ¥';
            productDetails.appendChild(detailTitle);
            
            products.forEach(product => {
                const productContainer = document.createElement('div');
                productContainer.className = 'product-container';
                
                const productTitle = document.createElement('h3');
                productTitle.textContent = product.name;
                
                productContainer.appendChild(productTitle);
                
                // ì œí’ˆëª… í‘œì‹œ (ì´ë¯¸ ì…ë ¥ë°›ì•˜ìœ¼ë¯€ë¡œ ìˆ˜ì • ë¶ˆê°€)
                const nameGroup = document.createElement('div');
                nameGroup.className = 'form-group';
                
                const nameLabel = document.createElement('label');
                nameLabel.textContent = 'ì œí’ˆëª…:';
                
                const nameInput = document.createElement('input');
                nameInput.type = 'text';
                nameInput.id = `productName_${product.id}`;
                nameInput.value = product.name;
                nameInput.readOnly = true;
                
                nameGroup.appendChild(nameLabel);
                nameGroup.appendChild(nameInput);
                productContainer.appendChild(nameGroup);
                
                // ê° ì†ì„±ë³„ ë ˆë²¨ ì„ íƒ (ê°€ê²©ì€ ë§ˆì§€ë§‰ìœ¼ë¡œ)
                const sortedProductAttributes = [...attributes].sort((a, b) => {
                    if (a.name.includes('ê°€ê²©')) return 1;
                    if (b.name.includes('ê°€ê²©')) return -1;
                    return 0;
                });
                
                sortedProductAttributes.forEach(attribute => {
                    const attrGroup = document.createElement('div');
                    attrGroup.className = 'form-group';
                    
                    const attrLabel = document.createElement('label');
                    attrLabel.textContent = `${attribute.name} (${attribute.scale}):`;
                    
                    const attrSelect = document.createElement('select');
                    attrSelect.id = `product_${product.id}_attr_${attribute.id}`;
                    
                    attribute.levels.forEach(level => {
                        const option = document.createElement('option');
                        option.value = level;
                        option.textContent = level;
                        attrSelect.appendChild(option);
                    });
                    
                    attrGroup.appendChild(attrLabel);
                    attrGroup.appendChild(attrSelect);
                    productContainer.appendChild(attrGroup);
                });
                
                productDetails.appendChild(productContainer);
            });
            
            document.getElementById('populationGroup').classList.remove('hide');
        }
        
        // AIë¥¼ ì‚¬ìš©í•˜ì—¬ ìœ í‹¸ë¦¬í‹° ì¶”ì •
        function estimateUtilities() {
            // ì†ì„± ë³„ë¡œ ìœ í‹¸ë¦¬í‹° ì¶”ì • ë¡œì§
            attributes.forEach(attribute => {
                const levelUtilities = {};
                
                // ì†ì„± íƒ€ì…ì— ë”°ë¼ ìœ í‹¸ë¦¬í‹° ê°’ ì¶”ì •
                if (attribute.name.includes('ê°€ê²©')) {
                    // ê°€ê²©: ë‚®ì„ìˆ˜ë¡ ë†’ì€ ìœ í‹¸ë¦¬í‹° (ìŒìˆ˜ ìœ í‹¸ë¦¬í‹°, ê°€ê²©ì´ ë†’ì„ìˆ˜ë¡ ìœ í‹¸ë¦¬í‹°ê°€ ë‚®ìŒ)
                    attribute.levels.forEach((level, index) => {
                        // ê°€ê²©ì—ì„œ ìˆ«ìë§Œ ì¶”ì¶œ
                        const priceMatch = level.match(/\d+/);
                        if (priceMatch) {
                            const price = parseInt(priceMatch[0]);
                            // ê°€ê²©ì´ ë†’ì„ìˆ˜ë¡ ë” ë‚®ì€ ìœ í‹¸ë¦¬í‹°
                            const normalizedPrice = price / 1000; // ì •ê·œí™”
                            levelUtilities[level] = -0.2 * normalizedPrice;
                        } else {
                            // ìˆ«ì ì¶”ì¶œ ë¶ˆê°€ëŠ¥í•œ ê²½ìš° ìˆœì„œì— ë”°ë¼ ìœ í‹¸ë¦¬í‹° ë¶€ì—¬
                            levelUtilities[level] = -0.2 * (index + 1);
                        }
                    });
                } else if (attribute.name.includes('í’ˆì§ˆ') || attribute.name.includes('ì„±ëŠ¥')) {
                    // í’ˆì§ˆ/ì„±ëŠ¥: ë†’ì„ìˆ˜ë¡ ë†’ì€ ìœ í‹¸ë¦¬í‹° (ì–‘ìˆ˜ ìœ í‹¸ë¦¬í‹°)
                    const qualityRank = {
                        'í•˜': 0.1,
                        'ì¤‘': 0.3,
                        'ìƒ': 0.5,
                        'ìµœìƒ': 0.7,
                        'í”„ë¦¬ë¯¸ì—„': 0.9
                    };
                    
                    attribute.levels.forEach((level, index) => {
                        if (qualityRank[level] !== undefined) {
                            levelUtilities[level] = qualityRank[level];
                        } else {
                            // ì¼ë°˜ì ìœ¼ë¡œ ë’¤ì— ìˆëŠ” ìˆ˜ì¤€ì´ ë” ì¢‹ì€ í’ˆì§ˆ
                            levelUtilities[level] = 0.2 * (index + 1);
                        }
                    });
                } else if (attribute.name.includes('ë¸Œëœë“œ')) {
                    // ë¸Œëœë“œ: ë¸Œëœë“œ ê°€ì¹˜ì— ë”°ë¥¸ ìœ í‹¸ë¦¬í‹°
                    const brandRank = {
                        'ì‹ ì œí’ˆ': 0.2,
                        'ì¸ê¸°ë¸Œëœë“œ': 0.4,
                        'ê¸€ë¡œë²Œë¸Œëœë“œ': 0.6,
                        'í”„ë¦¬ë¯¸ì—„ë¸Œëœë“œ': 0.8,
                        'ëŸ­ì…”ë¦¬ë¸Œëœë“œ': 1.0
                    };
                    
                    attribute.levels.forEach((level, index) => {
                        if (brandRank[level] !== undefined) {
                            levelUtilities[level] = brandRank[level];
                        } else {
                            // ë¸Œëœë“œëŠ” ì¤‘ê°„ ì •ë„ì˜ ìœ í‹¸ë¦¬í‹°
                            levelUtilities[level] = 0.3 + (0.1 * index);
                        }
                    });
                } else {
                    // ê¸°íƒ€ ì†ì„±: ìˆœì„œëŒ€ë¡œ ì ì°¨ ì¦ê°€í•˜ëŠ” ìœ í‹¸ë¦¬í‹°
                    attribute.levels.forEach((level, index) => {
                        // ì¼ë°˜ì ìœ¼ë¡œ ë’¤ì— ìˆëŠ” ìˆ˜ì¤€ì´ ë” ì„ í˜¸ë¨
                        levelUtilities[level] = 0.25 * (index + 1);
                    });
                }
                
                attribute.utilities = levelUtilities;
            });
            
            // ê° ì†ì„± ë³„ë¡œ ìœ í‹¸ë¦¬í‹° ê³„ì‚°
            products.forEach(product => {
                product.name = document.getElementById(`productName_${product.id}`).value;
                product.attributes = {};
                product.utility = 0;
                
                attributes.forEach(attribute => {
                    const levelElement = document.getElementById(`product_${product.id}_attr_${attribute.id}`);
                    const level = levelElement.value;
                    
                    product.attributes[attribute.name] = level;
                    product.utility += attribute.utilities[level];
                });
            });
            
            return true;
        }
        
        // ìœ í‹¸ë¦¬í‹° ê³„ì‚°
        function calculateUtilities() {
            // AIë¡œ ìœ í‹¸ë¦¬í‹° ì¶”ì •
            if (estimateUtilities()) {
                // ê²°ê³¼ í‘œì‹œ
                displayResults();
                
                // ì› ê·¸ë˜í”„ ì´ˆê¸°í™”
                initPieChart();
            } else {
                alert('ìœ í‹¸ë¦¬í‹° ì¶”ì • ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
            }
        }
        
        // ì› ê·¸ë˜í”„ ì´ˆê¸°í™”
        function initPieChart() {
            // ê¸°ì¡´ ì°¨íŠ¸ ì œê±°
            if (marketSharePieChart) {
                marketSharePieChart.destroy();
            }
            if (simulationPieChart) {
                simulationPieChart.destroy();
            }
            
            // ì œí’ˆë³„ ìƒ‰ìƒ ì„¤ì • - ëª¨ë˜í•œ ìƒ‰ìƒ íŒ”ë ˆíŠ¸ë¡œ ë³€ê²½ (ë” ì§„í•œ ìƒ‰ìƒ)
            const backgroundColors = [
                'rgba(91, 127, 255, 0.9)', // Soft blue
                'rgba(54, 209, 220, 0.9)', // Turquoise
                'rgba(92, 84, 164, 0.9)',  // Medium purple
                'rgba(255, 118, 118, 0.9)', // Coral pink
                'rgba(76, 181, 142, 0.9)', // Mint green
                'rgba(156, 136, 255, 0.9)', // Light purple
                'rgba(86, 204, 242, 0.9)', // Sky blue
                'rgba(255, 179, 71, 0.9)', // Soft orange
                'rgba(235, 107, 170, 0.9)', // Soft pink
                'rgba(68, 157, 209, 0.9)', // Blue
            ];
            
            // ì œí’ˆ ì´ë¦„ê³¼ ì„ íƒ í™•ë¥  ë°ì´í„° ì¶”ì¶œ
            const labels = products.map(product => product.name);
            const data = products.map(product => product.probability * 100);
            
            // Chart.js plugin configuration for adding percentage labels
            Chart.register({
                id: 'percentageLabels',
                afterDraw: function(chart) {
                    if (chart.config.type !== 'pie') return;
                    
                    const ctx = chart.ctx;
                    const chartArea = chart.chartArea;
                    const data = chart.data.datasets[0].data;
                    const labels = chart.data.labels;
                    const total = data.reduce((a, b) => a + b, 0);
                    
                    // Skip if no chartArea
                    if (!chartArea) return;
                    
                    // Pie chart center point
                    const centerX = (chartArea.left + chartArea.right) / 2;
                    const centerY = (chartArea.top + chartArea.bottom) / 2;
                    const radius = Math.min(chartArea.right - chartArea.left, chartArea.bottom - chartArea.top) / 2;
                    
                    // Create labels
                    let currentAngle = -0.5 * Math.PI; // Start from top
                    
                    for (let i = 0; i < data.length; i++) {
                        const sliceAngle = 2 * Math.PI * data[i] / total;
                        const angle = currentAngle + sliceAngle / 2;
                        
                        // Calculate position - move labels closer to edge for better visibility
                        const labelRadius = radius * 0.75;
                        
                        const x = centerX + Math.cos(angle) * labelRadius;
                        const y = centerY + Math.sin(angle) * labelRadius;
                        
                        const percentageText = `${data[i].toFixed(1)}%`;
                        
                        // Only draw label if slice is visible enough (> 3%)
                        if (data[i] / total > 0.03) {
                            // First draw a strong black outline/stroke around text
                            ctx.save();
                            ctx.font = 'bold 28px Arial'; // Even larger font
                            ctx.textAlign = 'center';
                            ctx.textBaseline = 'middle';
                            
                            // Draw text stroke (outline)
                            ctx.strokeStyle = 'black';
                            ctx.lineWidth = 6;
                            ctx.lineJoin = 'round'; // Rounded joins for smoother outline
                            ctx.strokeText(percentageText, x, y);
                            
                            // Draw text fill (white for maximum contrast)
                            ctx.fillStyle = 'white';
                            ctx.fillText(percentageText, x, y);
                            
                            ctx.restore();
                        }
                        
                        currentAngle += sliceAngle;
                    }
                }
            });
            
            // ì‹œì¥ ì ìœ ìœ¨ ì› ê·¸ë˜í”„ ìƒì„±
            const pieCtx = document.getElementById('marketSharePieChart').getContext('2d');
            marketSharePieChart = new Chart(pieCtx, {
                type: 'pie',
                data: {
                    labels: labels,
                    datasets: [{
                        data: data,
                        backgroundColor: backgroundColors.slice(0, products.length),
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            position: 'right',
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const label = context.label || '';
                                    const value = context.formattedValue || '';
                                    return `${label}: ${value}%`;
                                }
                            }
                        }
                    }
                }
            });
            
            // ì‹œë®¬ë ˆì´ì…˜ ì› ê·¸ë˜í”„ ì´ˆê¸°í™” (ë°ì´í„°ëŠ” ì‹œë®¬ë ˆì´ì…˜ ì‹œ ì—…ë°ì´íŠ¸)
            const simPieCtx = document.getElementById('simulationPieChart').getContext('2d');
            simulationPieChart = new Chart(simPieCtx, {
                type: 'pie',
                data: {
                    labels: labels,
                    datasets: [{
                        data: data,
                        backgroundColor: backgroundColors.slice(0, products.length),
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            position: 'right',
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const label = context.label || '';
                                    const value = context.formattedValue || '';
                                    return `${label}: ${value}%`;
                                }
                            }
                        }
                    }
                },
                // Uses the same plugin registered earlier
                plugins: ['percentageLabels']
            });
            
            // ì‹œë®¬ë ˆì´ì…˜ ì»¨íŠ¸ë¡¤ ì„¤ì •
            setupSimulationControls();
        }
        
        // ì‹œë®¬ë ˆì´ì…˜ ì œì–´ ì„¤ì •
        function setupSimulationControls() {
            const simulationControls = document.getElementById('simulationControls');
            simulationControls.innerHTML = '';
            
            // ì†ì„±ì„ ì •ë ¬í•˜ì—¬ ê°€ê²©ì„ ë§ˆì§€ë§‰ìœ¼ë¡œ
            const sortedSimAttributes = [...attributes].sort((a, b) => {
                if (a.name.includes('ê°€ê²©')) return 1;
                if (b.name.includes('ê°€ê²©')) return -1;
                return 0;
            });
            
            // ë³¸ì¸ ì œí’ˆ(ì²« ë²ˆì§¸ ì œí’ˆ)ì˜ ê° ì†ì„±ë³„ ìŠ¬ë¼ì´ë” ìƒì„±
            sortedSimAttributes.forEach(attribute => {
                const level = products[0].attributes[attribute.name];
                const utility = attribute.utilities[level];
                
                const sliderContainer = document.createElement('div');
                sliderContainer.className = 'slider-container';
                
                const sliderLabel = document.createElement('div');
                sliderLabel.className = 'slider-label';
                
                const sliderName = document.createElement('span');
                sliderName.textContent = `${attribute.name} ì¡°ì •`;
                
                const sliderValue = document.createElement('span');
                sliderValue.id = `slider_value_${attribute.id}`;
                sliderValue.textContent = '0%';
                
                sliderLabel.appendChild(sliderName);
                sliderLabel.appendChild(sliderValue);
                
                const slider = document.createElement('input');
                slider.type = 'range';
                slider.className = 'simulation-slider';
                slider.id = `attr_slider_${attribute.id}`;
                slider.min = '-50';
                slider.max = '50';
                slider.value = '0';
                slider.step = '5';
                
                slider.addEventListener('input', function() {
                    const value = parseInt(this.value);
                    document.getElementById(`slider_value_${attribute.id}`).textContent = `${value > 0 ? '+' : ''}${value}%`;
                });
                
                sliderContainer.appendChild(sliderLabel);
                sliderContainer.appendChild(slider);
                
                simulationControls.appendChild(sliderContainer);
            });
        }
        
        // ì‹œë®¬ë ˆì´ì…˜ ì‹¤í–‰
        function runSimulation() {
            // ì›ë³¸ ìœ í‹¸ë¦¬í‹° ê°’ì„ ë³µì‚¬í•˜ì—¬ ì‹œë®¬ë ˆì´ì…˜
            const originalProducts = JSON.parse(JSON.stringify(products));
            const myProduct = products[0]; // ì²« ë²ˆì§¸ ì œí’ˆì´ ë³¸ì¸ ì œí’ˆ
            
            // ê° ì†ì„±ë³„ ìŠ¬ë¼ì´ë” ê°’ì— ë”°ë¼ ìœ í‹¸ë¦¬í‹° ì¡°ì •
            attributes.forEach(attribute => {
                const slider = document.getElementById(`attr_slider_${attribute.id}`);
                const adjustmentPercent = parseInt(slider.value) / 100;
                
                const level = myProduct.attributes[attribute.name];
                const originalUtility = attribute.utilities[level];
                
                // ì¡°ì •ëœ ìœ í‹¸ë¦¬í‹° ê³„ì‚°
                const adjustedUtility = originalUtility * (1 + adjustmentPercent);
                
                // ì¡°ì •ëœ ìœ í‹¸ë¦¬í‹° ì ìš©
                myProduct.utility += (adjustedUtility - originalUtility);
            });
            
            // ì‹œë®¬ë ˆì´ì…˜ ê²°ê³¼ ê³„ì‚° (ë‹¤í•­ ë¡œì§€íŠ¸ ëª¨ë¸)
            const expUtilities = products.map(product => Math.exp(product.utility));
            const sumExpUtilities = expUtilities.reduce((a, b) => a + b, 0);
            
            products.forEach((product, index) => {
                product.simProbability = expUtilities[index] / sumExpUtilities;
            });
            
            // ì‹œë®¬ë ˆì´ì…˜ ê²°ê³¼ í‘œì‹œ
            displaySimulationResults();
            
            // ì›ë˜ ìœ í‹¸ë¦¬í‹° ê°’ìœ¼ë¡œ ë³µì›
            products = originalProducts;
        }
        
        // ì‹œë®¬ë ˆì´ì…˜ ê²°ê³¼ í‘œì‹œ
        function displaySimulationResults() {
            const simulationResults = document.getElementById('simulationResults');
            simulationResults.innerHTML = '';
            
            // ì› ê·¸ë˜í”„ ë°ì´í„° ì—…ë°ì´íŠ¸
            const labels = products.map(product => product.name);
            const data = products.map(product => (product.simProbability || product.probability) * 100);
            
            simulationPieChart.data.labels = labels;
            simulationPieChart.data.datasets[0].data = data;
            simulationPieChart.update();
            
            // ì‹œë®¬ë ˆì´ì…˜ ê²°ê³¼ ë§‰ëŒ€ ê·¸ë˜í”„ ì¶”ê°€
            const chartContainer = document.createElement('div');
            chartContainer.className = 'chart-container';
            
            const barChart = document.createElement('div');
            barChart.className = 'bar-chart';
            
            // ì œí’ˆë³„ ì‹œì¥ ì ìœ ìœ¨ ë°” ìƒì„±
            products.forEach((product, index) => {
                const barGroup = document.createElement('div');
                barGroup.className = 'bar-group';
                
                const barLabel = document.createElement('div');
                barLabel.className = 'bar-label';
                barLabel.textContent = product.name;
                barGroup.appendChild(barLabel);
                
                const barWrapper = document.createElement('div');
                barWrapper.className = 'bar-wrapper';
                
                const newProb = product.simProbability || product.probability;
                const sharePercentage = newProb * 100;
                
                const bar = document.createElement('div');
                bar.className = 'bar';
                bar.style.width = `${sharePercentage}%`;
                
                const barColors = [
                    'var(--chart-color-1)',
                    'var(--chart-color-2)',
                    'var(--chart-color-3)',
                    'var(--chart-color-4)',
                    'var(--chart-color-5)'
                ];
                bar.style.backgroundColor = barColors[index % barColors.length];
                
                barWrapper.appendChild(bar);
                
                const barValue = document.createElement('div');
                barValue.className = 'bar-value';
                barValue.textContent = `${sharePercentage.toFixed(1)}%`;
                bar.appendChild(barValue);
                
                barGroup.appendChild(barWrapper);
                barChart.appendChild(barGroup);
            });
            
            chartContainer.appendChild(barChart);
            simulationResults.appendChild(chartContainer);
            
            // í…Œì´ë¸” ê²°ê³¼ í‘œì‹œ
            const table = document.createElement('table');
            table.style.width = '100%';
            table.style.borderCollapse = 'collapse';
            table.style.boxShadow = '0 2px 10px rgba(0, 0, 0, 0.1)';
            table.style.margin = '40px auto';
            table.style.maxWidth = '800px';
            
            // í…Œì´ë¸” í—¤ë”
            const headerRow = document.createElement('tr');
            const headerCells = ['ì œí’ˆëª…', 'ì›ë˜ ì ìœ ìœ¨', 'ì¡°ì • í›„ ì ìœ ìœ¨', 'ë³€í™”'];
            
            headerCells.forEach(cell => {
                const th = document.createElement('th');
                th.textContent = cell;
                th.style.backgroundColor = 'var(--primary-color)';
                th.style.color = 'white';
                th.style.padding = '12px';
                th.style.textAlign = 'center';
                headerRow.appendChild(th);
            });
            
            table.appendChild(headerRow);
            
            // ê° ì œí’ˆë³„ ì‹œë®¬ë ˆì´ì…˜ ê²°ê³¼
            products.forEach((product, index) => {
                const row = document.createElement('tr');
                
                const nameCell = document.createElement('td');
                nameCell.textContent = product.name;
                nameCell.style.fontWeight = 'bold';
                nameCell.style.padding = '10px';
                nameCell.style.textAlign = 'center';
                
                const originalCell = document.createElement('td');
                originalCell.textContent = `${(product.probability * 100).toFixed(1)}%`;
                originalCell.style.padding = '10px';
                originalCell.style.textAlign = 'center';
                
                const newCell = document.createElement('td');
                const newProb = product.simProbability || product.probability;
                newCell.textContent = `${(newProb * 100).toFixed(1)}%`;
                newCell.style.fontWeight = 'bold';
                newCell.style.padding = '10px';
                newCell.style.textAlign = 'center';
                
                const changeCell = document.createElement('td');
                const change = ((newProb - product.probability) * 100).toFixed(1);
                changeCell.textContent = change > 0 ? `+${change}%` : `${change}%`;
                changeCell.style.padding = '10px';
                changeCell.style.textAlign = 'center';
                changeCell.style.fontWeight = 'bold';
                
                // ë³€í™”ì— ë”°ë¼ ìƒ‰ìƒ ì ìš©
                if (parseFloat(change) > 0) {
                    changeCell.style.color = 'green';
                } else if (parseFloat(change) < 0) {
                    changeCell.style.color = 'red';
                }
                
                row.appendChild(nameCell);
                row.appendChild(originalCell);
                row.appendChild(newCell);
                row.appendChild(changeCell);
                
                // Add alternating row colors
                if (index % 2 === 1) {
                    row.style.backgroundColor = '#f8f9fa';
                }
                
                table.appendChild(row);
            });
            
            simulationResults.appendChild(table);
        }
        
        // ê²°ê³¼ í‘œì‹œ
        function displayResults() {
            document.getElementById('resultsSection').style.display = 'block';
            
            // ìœ í‹¸ë¦¬í‹° í…Œì´ë¸” ìƒì„±
            const utilityResults = document.getElementById('utilityResults');
            utilityResults.innerHTML = '';
            
            // ê° ì œí’ˆë³„ ìœ í‹¸ë¦¬í‹° í…Œì´ë¸”ê³¼ ë§‰ëŒ€ ê·¸ë˜í”„
            products.forEach((product, productIndex) => {
                const productTitle = document.createElement('h4');
                productTitle.textContent = product.name;
                utilityResults.appendChild(productTitle);
                
                // ë§‰ëŒ€ ê·¸ë˜í”„ ì¶”ê°€
                const chartContainer = document.createElement('div');
                chartContainer.className = 'chart-container product-chart';
                
                const chartTitle = document.createElement('div');
                chartTitle.className = 'chart-title';
                chartTitle.textContent = 'ì†ì„±ë³„ ìœ í‹¸ë¦¬í‹° ì‹œê°í™”';
                chartContainer.appendChild(chartTitle);
                
                const barChart = document.createElement('div');
                barChart.className = 'bar-chart';
                
                // Add grid lines for better readability
                const barChartGrid = document.createElement('div');
                barChartGrid.className = 'bar-chart-grid';
                
                // ì†ì„±ë³„ ìœ í‹¸ë¦¬í‹° ê°’ê³¼ ìƒ‰ìƒ
                const barColors = [
                    'var(--chart-color-1)',
                    'var(--chart-color-2)',
                    'var(--chart-color-3)',
                    'var(--chart-color-4)',
                    'var(--chart-color-5)'
                ];
                
                // ìµœëŒ€ ìœ í‹¸ë¦¬í‹° ê°’ ì°¾ê¸° (ìŠ¤ì¼€ì¼ë§ìš©)
                let maxUtilityAbs = 0;
                attributes.forEach(attribute => {
                    const level = product.attributes[attribute.name];
                    const utility = attribute.utilities[level];
                    maxUtilityAbs = Math.max(maxUtilityAbs, Math.abs(utility));
                });
                
                maxUtilityAbs = Math.max(maxUtilityAbs, 1); // ìµœì†Œ ìŠ¤ì¼€ì¼ ì„¤ì •
                
                // Create grid lines
                for (let i = 0; i <= 5; i++) {
                    const gridLine = document.createElement('div');
                    gridLine.className = 'grid-line';
                    gridLine.style.left = `${i * 20}%`;
                    barChartGrid.appendChild(gridLine);
                }
                
                barChart.appendChild(barChartGrid);
                
                // Create x-axis labels
                const xAxis = document.createElement('div');
                xAxis.className = 'bar-chart-x-axis';
                for (let i = 0; i <= 5; i++) {
                    const label = document.createElement('div');
                    label.textContent = `${i * 0.2}`;
                    xAxis.appendChild(label);
                }
                
                // ì†ì„± ë°°ì—´ ë³µì‚¬ ë° ì¬ì •ë ¬ (ê°€ê²© ì†ì„±ì„ ë§ˆì§€ë§‰ìœ¼ë¡œ)
                const sortedAttributes = [...attributes].sort((a, b) => {
                    if (a.name.includes('ê°€ê²©')) return 1;
                    if (b.name.includes('ê°€ê²©')) return -1;
                    return 0;
                });
                
                // ê° ì†ì„±ì— ëŒ€í•œ ë°” ìƒì„±
                sortedAttributes.forEach((attribute, index) => {
                    const level = product.attributes[attribute.name];
                    const utility = attribute.utilities[level];
                    
                    // Calculate percentage for display
                    const percentage = Math.abs(utility) / maxUtilityAbs * 100;
                    
                    const barGroup = document.createElement('div');
                    barGroup.className = 'bar-group';
                    
                    const barLabel = document.createElement('div');
                    barLabel.className = 'bar-label';
                    barLabel.textContent = attribute.name;
                    barGroup.appendChild(barLabel);
                    
                    const barWrapper = document.createElement('div');
                    barWrapper.className = 'bar-wrapper';
                    
                    const bar = document.createElement('div');
                    bar.className = 'bar';
                    bar.style.width = `${percentage}%`;
                    
                    // Find the original index for coloring
                    const originalIndex = attributes.findIndex(attr => attr.name === attribute.name);
                    bar.style.backgroundColor = barColors[originalIndex % barColors.length];
                    
                    barWrapper.appendChild(bar);
                    
                    const barValue = document.createElement('div');
                    barValue.className = 'bar-value';
                    barValue.textContent = `${Math.round(percentage)}%`;
                    bar.appendChild(barValue);
                    
                    barGroup.appendChild(barWrapper);
                    barChart.appendChild(barGroup);
                });
                
                // ì´ ìœ í‹¸ë¦¬í‹° ë°”ëŠ” ì œê±° (ìš”ì²­ì— ë”°ë¼)
                
                barChart.appendChild(xAxis);
                
                chartContainer.appendChild(barChart);
                utilityResults.appendChild(chartContainer);
                
                // ê¸°ì¡´ í…Œì´ë¸” ì¶”ê°€
                const table = document.createElement('table');
                
                // í…Œì´ë¸” í—¤ë”
                const headerRow = document.createElement('tr');
                const headerCells = ['ì†ì„±', 'ìˆ˜ì¤€', 'ìœ í‹¸ë¦¬í‹°'];
                headerCells.forEach(cell => {
                    const th = document.createElement('th');
                    th.textContent = cell;
                    headerRow.appendChild(th);
                });
                table.appendChild(headerRow);
                
                // ì†ì„±ë³„ ìœ í‹¸ë¦¬í‹°
                let totalUtility = 0;
                
                // ê°™ì€ ì •ë ¬ ìˆœì„œ ì‚¬ìš© (ê°€ê²©ì„ ë§ˆì§€ë§‰ìœ¼ë¡œ)
                sortedAttributes.forEach(attribute => {
                    const level = product.attributes[attribute.name];
                    const utility = attribute.utilities[level];
                    totalUtility += utility;
                    
                    const row = document.createElement('tr');
                    
                    const attrCell = document.createElement('td');
                    attrCell.textContent = attribute.name;
                    
                    const levelCell = document.createElement('td');
                    levelCell.textContent = level;
                    
                    const utilityCell = document.createElement('td');
                    utilityCell.textContent = utility > 0 ? `+${utility.toFixed(4)}` : utility.toFixed(4);
                    
                    row.appendChild(attrCell);
                    row.appendChild(levelCell);
                    row.appendChild(utilityCell);
                    
                    table.appendChild(row);
                });
                
                // ì´ ìœ í‹¸ë¦¬í‹° í–‰ì€ ì œê±° (ìš”ì²­ì— ë”°ë¼)
                
                utilityResults.appendChild(table);
            });
            
            // ì œí’ˆ ìš”ì•½ í…Œì´ë¸” ìƒì„± (ê²°ê³¼2ì— í‘œì‹œë  í…Œì´ë¸”)
            const summaryTable = document.createElement('table');
            summaryTable.style.marginTop = '30px';
            summaryTable.style.width = '100%';
            summaryTable.style.borderCollapse = 'collapse';
            summaryTable.style.boxShadow = '0 2px 10px rgba(0, 0, 0, 0.1)';
            
            // í…Œì´ë¸” í—¤ë”
            const headerRow = document.createElement('tr');
            const population = parseInt(document.getElementById('population').value);
            const headerCells = ['ì œí’ˆëª…', 'ìœ í‹¸ë¦¬í‹° í•©', 'ì„ íƒ í™•ë¥ ', `ì˜ˆìƒ ì¸ì› (ë„ì‹œ ì¸êµ¬ ${population.toLocaleString()}ëª… ê¸°ì¤€)`];
            
            headerCells.forEach(cell => {
                const th = document.createElement('th');
                th.textContent = cell;
                th.style.backgroundColor = 'var(--primary-color)';
                th.style.color = 'white';
                th.style.padding = '12px';
                th.style.textAlign = 'center';
                headerRow.appendChild(th);
            });
            
            summaryTable.appendChild(headerRow);
            
            // ë‹¤í•­ ë¡œì§€íŠ¸ ëª¨ë¸ ê³„ì‚°
            const expUtilities = products.map(product => Math.exp(product.utility));
            const sumExpUtilities = expUtilities.reduce((a, b) => a + b, 0);
            
            products.forEach((product, index) => {
                const probability = expUtilities[index] / sumExpUtilities;
                const expectedPopulation = Math.round(probability * population);
                
                product.probability = probability;
                product.expectedPopulation = expectedPopulation;
                
                const row = document.createElement('tr');
                
                const nameCell = document.createElement('td');
                nameCell.textContent = product.name;
                nameCell.style.fontWeight = 'bold';
                nameCell.style.padding = '10px';
                nameCell.style.textAlign = 'center';
                
                const utilityCell = document.createElement('td');
                utilityCell.textContent = product.utility.toFixed(4);
                utilityCell.style.padding = '10px';
                utilityCell.style.textAlign = 'center';
                
                const probCell = document.createElement('td');
                probCell.textContent = `${(probability * 100).toFixed(1)}%`;
                probCell.style.fontWeight = 'bold';
                probCell.style.padding = '10px';
                probCell.style.textAlign = 'center';
                
                const popCell = document.createElement('td');
                popCell.textContent = `${expectedPopulation.toLocaleString()}ëª…`;
                popCell.style.padding = '10px';
                popCell.style.textAlign = 'center';
                
                row.appendChild(nameCell);
                row.appendChild(utilityCell);
                row.appendChild(probCell);
                row.appendChild(popCell);
                
                // Add alternating row colors
                if (index % 2 === 1) {
                    row.style.backgroundColor = '#f8f9fa';
                }
                
                summaryTable.appendChild(row);
            });
            
            // ê²°ê³¼3 ì„¹ì…˜ì— ìš”ì•½ í…Œì´ë¸” ì¶”ê°€
            const summaryResults = document.getElementById('summaryResults');
            summaryResults.innerHTML = '';
            summaryResults.appendChild(summaryTable);
            
            // ì‹œì¥ ì ìœ ìœ¨ ì‹œê°í™” ì°¨íŠ¸ëŠ” ìˆ¨ê¹€ ì²˜ë¦¬ (ìš”ì²­ëŒ€ë¡œ ì œê±°)
            const marketShareResults = document.getElementById('marketShareResults');
            marketShareResults.innerHTML = '';
            
            // ìœ„ìª½ìœ¼ë¡œ ìŠ¤í¬ë¡¤
            document.getElementById('resultsSection').scrollIntoView({ behavior: 'smooth' });
        }
        
        // ì‹œë®¬ë ˆì´ì…˜ ë¦¬ì…‹
        function resetSimulation() {
            document.getElementById('resultsSection').style.display = 'none';
            document.getElementById('productDetails').classList.add('hide');
            document.getElementById('attributeSetup').classList.add('hide');
            document.getElementById('productSetup').classList.add('hide');
            document.getElementById('populationGroup').classList.add('hide');
            
            document.getElementById('numProducts').value = 3;
            document.getElementById('numAttributes').value = 3;
            
            products = [];
            attributes = [];
            utilities = {};
        }
        
        // ì œí’ˆ ì†ì„± ì¡°ì •
        function adjustProduct() {
            document.getElementById('resultsSection').style.display = 'none';
            document.getElementById('productDetails').classList.remove('hide');
            document.getElementById('populationGroup').classList.remove('hide');
            document.getElementById('productDetails').scrollIntoView({ behavior: 'smooth' });
        }
        
        // ì´ˆê¸°í™”
        function init() {
            // í•œêµ­ì–´ í°íŠ¸ ì¶”ê°€
            const link = document.createElement('link');
            link.rel = 'stylesheet';
            link.href = 'https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css';
            document.head.appendChild(link);
            
            const fontLink = document.createElement('link');
            fontLink.rel = 'stylesheet';
            fontLink.href = 'https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700&display=swap';
            document.head.appendChild(fontLink);
        }
        
        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸°í™”
        window.onload = init;
    </script>
</body>
</html>